
<!doctype html>

<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Add</title>
		<meta name="description" content="form to add new mortgages">
		<meta name="author" content="Mark Tyers">
        <meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="{{host}}/style.css" type="text/css" rel="stylesheet" />
		<script type="module" src="{{host}}/main.js"></script>
       
	</head>
	<body>
		<header>
		<h1>Add a mortgage</h1>
            <a href="/logout">Log out</a>
		<a href="/">Home page</a>
        <a href ="/mortgage/data">Financial data</a>    
		</header>
		{{#if msg}}
 			<aside>
				<p class="msg">{{msg}}</p>
			</aside>
		{{/if}}
		<main>
		<form action="/mortgage/add" method="post">
			  <div>
                
            <p>
				<label for="amount">Amount to borrow : </label><br />
				<input id = "range1" class = "slider"type="range" name="amount" min = "50000" max = "800000" value = "0" placeholder="preferred amount" value="{{body.amount}}" autofocus><p class = "sliderval">Amount: £ <span id="val1"> </span>
			
                  </p>
                </div>
        <div>
                
            <p>
				<label for="amount">Deposit to make : </label><br />
				<input id = "range2" class = "slider" type="range" name="deposit" min = "5000" max = "300000" placeholder="preferred amount" value="{{body.deposit}}" autofocus><p class = "sliderval">Deposit: £ <span id="val2"> </span>
			
                  </p>
                </div>
           <div>
                
            <p>
				<label for="years">Number of years : </label><br />
				<input id = "range3" class = "slider" type="range" name="years" min = "5" max = "30" placeholder="preferred amount" value="{{body.years}}" autofocus><p class = "sliderval">Years : <span id="val3"> </span>
                  </p>
                </div>
            <div>
                <hr><p style = 'font : 50px;'>Monthly Payment: <span id="res" class="currency"></span></p><hr>
            </div>
                <input type="hidden" name="referrer" value="{{referrer}}">
			<p><input type="submit" value="Submit"></p>
            
		</form>
		</main>
        <script>
            var slider1 = document.getElementById("range1");
            var slider2 = document.getElementById("range2");
            var slider3 = document.getElementById("range3");
            var result1 = document.getElementById("val1");
            var result2 = document.getElementById("val2");
            var result3 = document.getElementById("val3");
            result1.innerHTML = slider1.value;
            result2.innerHTML = slider2.value;
            result3.innerHTML = slider3.value;
            slider1.oninput = function() {
                result1.innerHTML = this.value;
                calcres();
            }
            slider2.oninput = function() {
                result2.innerHTML = this.value;
                calcres();
            }
             slider3.oninput = function() {
                result3.innerHTML = this.value;
                calcres();
             }
            var calculate = function (amount,years,deposit){
    var depositprcnt = (deposit / amount) * 100
    console.log(depositprcnt)
    if ( depositprcnt >= 5 && depositprcnt <= 9 ){
        var interest_rate = 6 
    }
    else if (depositprcnt >= 10 && depositprcnt <= 20){
        interest_rate = 4 
    }
    else if (depositprcnt >= 21 && depositprcnt <= 30){
        interest_rate = 3 
    } 
    else {
        interest_rate = 2.3 
    } 
    var monthlyRate = interest_rate / 100 / 12;
    var monthly_payment = amount * monthlyRate / (1 - (Math.pow(1 / (1 + monthlyRate), years * 12)));
    return monthly_payment ; 
} ;
            function calcres () {
                var amount = slider1.value;
                var deposit = slider2.value;
                var years = slider3.value;
                var monthlyPayment = calculate(amount, years,deposit);
                document.getElementById("res").innerHTML = monthlyPayment.toFixed(3);
            }
        </script>
	</body>
</html>
